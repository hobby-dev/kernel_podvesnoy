# Литература
Роберт Лав: Ядро Linux описание процесса разработки
Understanding Linux Kernel 
Таненбаум: СОвременные ОС
Дейтел: Операционные системы

# Повторяем с прошлых занятий
* struct task_struct - дескриптор процессе
* current - макрос, который позволяет ОС в пространстве ядра получить указать на дескриптор текущего процесса. Реализован с помощью per-cpu variables.
* Макрос - инструкция препроцессора, заменяет одну строку другой до копиляции
* Поток - абстракция (легковесные процессы). В рамках одного процесса может быть несколько контекстов исполнения. Они и есть потоки. В разных ОС реализуется по-разному. В Linux процессы и потоки - это struct task_struct, использующие указатели на одни и те же ресурсы, т.е. нет разницы между однопоточным процессом и потоком этого процесса.
* Создание процесса - fork(), exec(), copy-on-write

# Срыв покровов:
* vfork() - делает форм и выполняет новый процесс в этом же адресном пространстве. Для избежания ошибок выполнение родителя блокируется.Использовать не надо! Устарел. Специальный костыль - поле в task_struct vfork_done
* системный вызов clone() - создаёт процессы и потоки! Используется fork()'ом и pthread-ами.
```
$ man 2 clone
```
Самое интересное - это флаги. Вот формула создания потока:
```
CLONE_VM | CLONE_FS | CLONE_FILES | CLONE_SIGHAND
```
# Смотрим исходники
* Создание процессов: kernel/fork.c
_do_fork() - создаёт struct task_struct и сразу же его запускает в надежде, что тот вызовет exec()
* reference count - счётчик ссылок + автоматическая очистка памяти
* copy_files() 
* alloc_pid()




